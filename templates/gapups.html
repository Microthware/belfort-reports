<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gap-Up History & Outcomes</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0b0f14;--card:#11161d;--muted:#9bb1c8;--text:#e8f0fa;--green:#16a34a;--red:#dc2626;--border:#223142;
      --row-h: 42px;   /* approx row height */
      --head-h: 44px;  /* header height */
      --tbl-h: calc(var(--head-h) + 20 * var(--row-h)); /* visible rows height */
      --tbl-8: calc(var(--head-h) + 8 * var(--row-h)); /* visible rows height */
    }
    html,body{background:var(--bg);color:var(--text);margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:1200px;margin:28px auto;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:22px;margin:0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
    table{width:100%;border-collapse:collapse}
    thead th{
      text-align:left;font-weight:600;font-size:13px;color:var(--muted);
      padding:10px 12px;border-bottom:1px solid var(--border);
    }
    tbody td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:14px;white-space:nowrap}
    .pct.up{color:var(--green);font-weight:600}
    .pct.down{color:var(--red);font-weight:600}
    a{color:#9ecbff;text-decoration:none}
    a:hover{text-decoration:underline}
    .chip{border:1px solid var(--border);border-radius:999px;padding:1px 8px;font-size:12px;color:var(--muted)}
    .section-title{font-size:14px;font-weight:700;margin:0 0 8px;letter-spacing:.3px;color:#cfe1f7}

    /* Bottom-right timestamp */
    .footer-updated{
      position:fixed;
      right:12px;
      bottom:10px;
      color:var(--muted);
      font-size:12px;
      background:rgba(11,15,20,0.7);
      backdrop-filter:saturate(120%) blur(4px);
      border:1px solid var(--border);
      border-radius:8px;
      padding:4px 8px;
    }

    /* Scroll container for the per-day history table */
    .table-scroll-20{
      position: relative;           /* sticky context */
      max-height:var(--tbl-h);
      overflow:auto;
      border-radius:10px;
      /* Firefox scrollbar */
      scrollbar-width: thin;
      scrollbar-color:#2b3a4d #0f141b; /* thumb, track */
    }
    /* WebKit (Chrome/Edge/Safari) scrollbar */
    .table-scroll-20::-webkit-scrollbar{ width:8px;height:8px; }
    .table-scroll-20::-webkit-scrollbar-track{ background:#0f141b;border-radius:10px; }
    .table-scroll-20::-webkit-scrollbar-thumb{
      background-color:#2b3a4d;border-radius:10px;border:2px solid #0f141b;
    }
    .table-scroll-20::-webkit-scrollbar-thumb:hover{ background-color:#3b4f69; }

    /* Sticky header stays opaque above rows */
    .table-scroll-20 thead th{
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--card);
      box-shadow: 0 1px 0 0 var(--border) inset;
    }

    .table-scroll-8{
      position: relative;           /* sticky context */
      max-height:var(--tbl-8);
      overflow:auto;
      border-radius:10px;
      /* Firefox scrollbar */
      scrollbar-width: thin;
      scrollbar-color:#2b3a4d #0f141b; /* thumb, track */
    }
    /* WebKit (Chrome/Edge/Safari) scrollbar */
    .table-scroll-8::-webkit-scrollbar{ width:8px;height:8px; }
    .table-scroll-8::-webkit-scrollbar::-webkit-scrollbar-track{ background:#0f141b;border-radius:10px; }
    .table-scroll-8::-webkit-scrollbar-thumb{
      background-color:#2b3a4d;border-radius:10px;border:2px solid #0f141b;
    }
    .table-scroll-8::-webkit-scrollbar-thumb:hover{ background-color:#3b4f69; }

    /* Sticky header stays opaque above rows */
    .table-scroll-8 thead th{
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--card);
      box-shadow: 0 1px 0 0 var(--border) inset;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;align-items:center;gap:12px">
        <a class="back" href="overview.html" style="color:#9ecbff;text-decoration:none">&larr; Back</a>
        <h1>Gap-Up History & Outcomes</h1>
      </div>
      <!-- removed top-right timestamp -->
    </header>

    <!-- Historical consecutive-day streaks -->
    <section class="card" style="margin-bottom:14px">
      <div class="table-scroll-8">
        <div class="section-title">Historical Consecutive-Day Streaks (≥2 days)</div>
        <table id="streaks">
          <thead>
            <tr>
              <th></th>
              <th>Streak</th>
              <th>Change since streak start</th>
              <th>Change after 10 trading days</th>
              <th>Change after 40 trading days</th>
              <th>Streak start</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Per-day table (scrollable) -->
    <section class="card">
      <div class="table-scroll-20">
        <table id="tbl">
          <thead>
            <tr>
              <th>Date</th>
              <th>Symbol</th>
              <th>Price</th>
              <th>Next&nbsp;Day</th>
              <th>Next&nbsp;Day&nbsp;%</th>
              <th>Week</th>
              <th>Week&nbsp;%</th>
              <th>Month</th>
              <th>Month&nbsp;%</th>
              <th>Market D/W/M</th>
              <th>Streak</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <div class="footer-updated">Updated {{ gen_time }}</div>

  <script>
    const ROWS = {{ rows_json | safe }};
    const STREAKS = {{ streaks_json | safe }};

    function money(v){ if(!v) return "—"; const n=Number(v); return isFinite(n) ? "$"+n.toFixed(2) : String(v); }
    function pct(v){
      if(v===null || v===undefined || v==="") return "—";
      const n=Number(v);
      if(!isFinite(n)) return "—";
      const cls = n>=0 ? "pct up" : "pct down";
      return `<span class="${cls}">${(n*100).toFixed(2)}%</span>`;
    }

    // Render historical streaks (with 10/40 trading-day columns)
    const sbody = document.querySelector("#streaks tbody");
    sbody.innerHTML = (STREAKS || []).map(s => `
      <tr>
        <td><strong>${s.symbol}</strong></td>
        <td>${s.streak_len}d</td>
        <td>${pct(s.pct_since_second)}</td>
        <td>${pct(s.pct_10d_since_second)}</td>
        <td>${pct(s.pct_40d_since_second)}</td>
        <td>${s.second_day || "—"}</td>
      </tr>
    `).join("");

    // Render daily rows
    const tbody=document.querySelector("#tbl tbody");
    tbody.innerHTML = ROWS.map(r=>`
      <tr>
        <td>${r.date||"—"}</td>
        <td><strong>${r.symbol||"—"}</strong></td>
        <td>${money(r.price)}</td>
        <td>${money(r.next_day_price)}</td>
        <td>${pct(r.next_day_pct)}</td>
        <td>${money(r.week_price)}</td>
        <td>${pct(r.week_pct)}</td>
        <td>${money(r.month_price)}</td>
        <td>${pct(r.month_pct)}</td>
        <td>${[pct(r.mkt_day_pct), pct(r.mkt_week_pct), pct(r.mkt_month_pct)].join(" / ")}</td>
        <td>${(Number(r.streak||"1")>=2)? `<span class="chip">${r.streak}d</span>` : "—"}</td>
      </tr>`).join("");
  </script>
</body>
</html>
