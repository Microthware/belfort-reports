<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Overview — Daily Reports</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#0b0f14;--card:#11161d;--muted:#8ea0b3;--text:#e7eef7;--green:#16a34a;--red:#dc2626;--border:#223142}
    html,body{background:var(--bg);color:var(--text);margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:28px auto 56px;padding:0 16px}
    h1{font-size:22px;margin:0 0 12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
    .section-title{font-size:14px;font-weight:700;margin:6px 0 12px;letter-spacing:.3px;color:#cfe1f7}
    .muted{color:var(--muted);font-size:12px}
    a{color:#9ecbff;text-decoration:none}
    a:hover{text-decoration:underline}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 10px;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap; vertical-align:middle}
    thead th{color:var(--muted);font-size:12px}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;margin-left:8px}
    .up{color:var(--green);border-color:rgba(22,163,74,.35)}
    .down{color:var(--red);border-color:rgba(220,38,38,.35)}

    /* circular win-rate */
    .ring{width:40px;height:40px;display:inline-block;position:relative}
    .ring svg{width:40px;height:40px;display:block}
    .ring .txt{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:11px}

    .footer-updated{position:fixed;right:12px;bottom:10px;color:var(--muted);font-size:12px}
    .bots-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .summary{display:flex;gap:16px;align-items:center}
    .summary .label{font-size:12px;color:var(--muted)}
  </style>

<style>
/* portfolios-mini (no-fetch) */
.portfolios-card{cursor:pointer}
.portfolios-card .mini-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:16px;
  margin-top:10px;
}
.mini-card{
  background:rgba(255,255,255,.02);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}
.mini-pie{width:120px;height:120px;position:relative;flex:0 0 auto}
.mini-legend{display:flex;flex-direction:column;gap:4px;font-size:12px}
.mini-legend .row{display:flex;align-items:center;gap:6px}
.mini-legend .sw{width:9px;height:9px;border-radius:2px;display:inline-block}
.mini-title{font-weight:700;margin-bottom:6px;color:#cfe1f7}
@media (max-width:520px){
  .mini-card{flex-direction:column;align-items:flex-start}
}
</style>

  <style>
    .section-title{display:flex;align-items:center;gap:8px}
    .title-ico{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;opacity:.85}
    .title-ico svg{display:block;width:18px;height:18px}
  </style>
<style>
  /* price badge next to ticker */
  .gap-price{
    font-weight:700;
    font-variant-numeric: tabular-nums;
    letter-spacing:.2px;
  }
  .gap-price.up{ color:#FFFFFF }
  .gap-price.down{ color:#FFFFFF }
</style>
<style>
/* overview-icons-and-donuts */
.section-title{display:flex;align-items:center;gap:8px}
.title-ico{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;opacity:.9}
.title-ico svg{display:block;width:18px;height:18px}
.portfolios-card .mini-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:10px}
.mini-card{background:rgba(255,255,255,.02);border:1px solid var(--border,#223142);border-radius:12px;padding:10px;display:flex;gap:10px;align-items:center}
.mini-pie{width:120px;height:120px;position:relative;flex:0 0 auto}
.mini-legend{display:flex;flex-direction:column;gap:4px;font-size:12px}
.mini-legend .row{display:flex;align-items:center;gap:6px}
.mini-legend .sw{width:9px;height:9px;border-radius:2px;display:inline-block}
.mini-title{font-weight:700;margin-bottom:6px;color:#cfe1f7}
</style>

<!-- NEW: gap-ups mini-candles styles -->
<style>
.gaps-grid{
  margin-top:8px;
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(240px,1fr));
  gap:12px;
}
.gap-card{
  background:rgba(255,255,255,.02);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
}
.gap-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.gap-sym{font-weight:700}
.gap-canvas{width:100%;height:120px;display:block}
.gap-streak{
  margin-left:8px;
  font-size:11px;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(250,204,21,.35); /* amber */
  background:rgba(250,204,21,.08);
  color:#facc15;
  font-variant-numeric: tabular-nums;
  letter-spacing:.2px;
}
</style>

</head>
<body>
  <div class="wrap">
    <h1>Overview</h1>

    <!-- Section 1: Bots (includes summary) -->
    <section class="card">
      <div class="bots-header">
        <div class="section-title" style="margin:0"><span class="title-ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#9ecbff" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="10" rx="2"/><circle cx="8.5" cy="13" r="1.5"/><circle cx="15.5" cy="13" r="1.5"/><path d="M12 8V4"/><path d="M10 4h4"/></svg></span>Bots</div>
        <div class="summary">
          <div class="label">Total actions: <strong>{{ total_trades }}</strong></div>
          <div class="label">Avg win rate: <strong>{{ avg_win_rate }}</strong></div>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Bot</th>
            <th>Universe</th>
            <th>Win Rate</th>
            <th>Avg Win</th>
            <th>Avg Loss</th>
            <th>Balance</th>
            <th>Trades</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody>
          {% for b in bots %}
          <tr>
            <td><a href="{{ b.link }}"><strong>{{ b.name }}</strong></a></td>
            <td class="muted">{{ b.symbols }}</td>
            <td>
              <div class="ring" title="{{ b.win_rate }}">
                <svg viewBox="0 0 40 40" role="img" aria-label="Win rate {{ b.win_rate }}">
                  <circle cx="20" cy="20" r="16" stroke="#2c3238" stroke-width="4" fill="none"></circle>
                  {% set circumference = 100.53 %}
                  {% set fraction = b.win_rate_num or 0 %}
                  {% set offset = circumference * (1 - fraction) %}
                  <circle cx="20" cy="20" r="16" stroke="currentColor" stroke-width="4" fill="none"
                          stroke-dasharray="{{ circumference }}" stroke-dashoffset="{{ offset|round(2) }}"
                          transform="rotate(-90 20 20)"></circle>
                </svg>
                <div class="txt">{{ b.win_rate }}</div>
              </div>
            </td>
            <td>{{ b.avg_win }}</td>
            <td>{{ b.avg_loss }}</td>
            <td>
              {{ b.balance }}
              {% if b.balance_dir >= 0 %}
                <span class="pill up">▲</span>
              {% else %}
                <span class="pill down">▼</span>
              {% endif %}
            </td>
            <td>{{ b.trades }}</td>
            <td class="muted">{{ b.updated }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <!-- Section 2: Market Studies (at bottom) -->
    <section class="card" style="margin-top:14px;">
      <div class="section-title">Market Studies</div>
      <ul style="margin:6px 0 0; padding-left:16px; line-height:1.9;">
        <li><a href="gapups.html">Gap-Up History &amp; Outcomes</a></li>
      </ul>

      <!-- NEW: Today’s Gap-Ups list + 14-day mini candles -->
      <div class="section-title" style="margin-top:14px">Today's Gap-Ups</div>
      <div id="gapups-today" class="gaps-grid"></div>
    </section>

    <!-- Section 3: Portfolios -->
    <section class="portfolios-card card" style="margin-top:14px;">
      <div class="section-title">
        <span class="title-ico" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="#a7f3d0">
            <path d="M12 2c2.75 0 5 2.25 5 5s-2.25 5-5 5-5-2.25-5-5 2.25-5 5-5Zm-7 18c0-3.6 5.2-5.5 7-5.5s7 1.9 7 5.5v1H5v-1Z"/>
          </svg>
        </span>
        High Profile Portfolios</div>
      <div class="mini-grid" id="mini-portfolios"></div>
      <div class="muted" style="margin-top:8px">Click anywhere in this card to open detailed portfolios.</div>
    </section>
  </div>

  <div class="footer-updated">Updated {{ gen_time }}</div>

<script>
// portfolios-mini render (no-fetch): uses same SECTIONS strategy as portfolios.html
(function(){
  const SECTIONS = {{ sections_json | default('[]') | safe }};
  const palette = ['#0021A5','#FA4616','#0077c0','#22884C','#D50A0A','#FCD006','#4B2A91','#6B21A8','#0EA5E9','#FF7900','#A855F7','#CA8A04','#34302B','#B1BABf'];
  const MAX_HOLDINGS = null; // show all
  const ANGLE_OFFSET = Math.PI/2;

  function pctText(n){ if(!isFinite(n)) return '—'; const p=n*100; return (p<0.1&&p>0)?'<0.1%':p.toFixed(2)+'%'; }

  function drawMiniDonut(el, items){

    const w=120,h=120,cx=60,cy=60,r=44;
    const NS='http://www.w3.org/2000/svg';
    const svg=document.createElementNS(NS,'svg'); svg.setAttribute('viewBox','0 0 '+w+' '+h); svg.setAttribute('width', w); svg.setAttribute('height', h);
    let start=0;
    items.forEach((x,i)=>{
      const frac=Math.max(0,x.weight||0);
      const end=start+frac*2*Math.PI;
      const large=(end-start)>Math.PI?1:0;
      const sA=start+ANGLE_OFFSET, eA=end+ANGLE_OFFSET;
      const x1=cx+r*Math.cos(sA), y1=cy+r*Math.sin(sA);
      const x2=cx+r*Math.cos(eA), y2=cy+r*Math.sin(eA);
      const p=document.createElementNS(NS,'path');
      p.setAttribute('d','M '+cx+' '+cy+' L '+x1+' '+y1+' A '+r+' '+r+' 0 '+large+' 1 '+x2+' '+y2+' Z');
      p.setAttribute('fill', palette[i%palette.length]);
      svg.appendChild(p);
      start=end;
    
    // add donut inner circle like portfolios.html
    const hole = document.createElementNS(svgNS,'circle');
    hole.setAttribute('cx', cx);
    hole.setAttribute('cy', cy);
    hole.setAttribute('r', String(Math.round(r*0.58)));
    try{
      const card = getComputedStyle(document.documentElement).getPropertyValue('--card').trim() || '#11161d';
      const border = getComputedStyle(document.documentElement).getPropertyValue('--border').trim() || '#223142';
      hole.setAttribute('fill', card);
      hole.setAttribute('stroke', border);
      hole.setAttribute('stroke-width', '1');
    }catch(e){
      hole.setAttribute('fill', '#11161d');
      hole.setAttribute('stroke', '#223142');
      hole.setAttribute('stroke-width', '1');
    }
    svg.appendChild(hole);

});
    el.innerHTML=''; el.appendChild(svg);
  }

  function buildMiniCard(sec){
    const box=document.createElement('div'); box.className='mini-card';
    const pie=document.createElement('div'); pie.className='mini-pie';
    const legend=document.createElement('div'); legend.className='mini-legend';
    const title=document.createElement('div'); title.className='mini-title'; title.textContent=sec.name || 'Portfolio';
    legend.appendChild(title);
    const items=(sec.holdings||[]);
    drawMiniDonut(pie, items);
    items.forEach((x,i)=>{
      const row=document.createElement('div'); row.className='row';
      const sw=document.createElement('span'); sw.className='sw'; sw.style.background=palette[i%palette.length];
      const label=document.createElement('span'); label.innerHTML=(x.ticker||'?')+' — '+pctText(x.weight);
      row.appendChild(sw); row.appendChild(label); legend.appendChild(row);
    });
    box.appendChild(pie); box.appendChild(legend);
    return box;
  }

  // Render immediately (script is at end of body so DOM exists)
  (function render(){
    const host = document.getElementById('mini-portfolios');
    if(!host) return;
    host.innerHTML='';
    (SECTIONS || []).forEach(sec => host.appendChild(buildMiniCard(sec)));
  })();

  // Make the entire card clickable to portfolios.html (preserve link clicks)
  (function bindClick(){
    const heading = Array.from(document.querySelectorAll('h1,h2,h3,div.section-title'))
      .find(h => /High Profile Portfolios/i.test(h.textContent||''));
    const card = heading ? heading.closest('section') : null;
    if(!card) return;
    card.classList.add('portfolios-card');
    card.addEventListener('click', (e)=>{
      const a = e.target.closest && e.target.closest('a');
      if(a) return;
      window.location.href='portfolios.html';
    });
  })();
})();
</script>

<script>
// NEW: Today's Gap-Ups mini candlesticks (14 trading days)
(function(){
  const DATA = (function(){ try { return {{ gapups_today_json | default('[]') | safe }}; } catch(e){ return []; } })();
  const host = document.getElementById('gapups-today');
  if(!host || !DATA || !DATA.length) return;

  function drawCandle(ctx, x, w, yOpen, yClose, yHigh, yLow, up){
    // wick
    ctx.beginPath();
    ctx.moveTo(x, yHigh); ctx.lineTo(x, yLow);
    ctx.strokeStyle = up ? '#16a34a' : '#dc2626';
    ctx.lineWidth = 1; ctx.stroke();
    // body
    const left = x - w/2, h = Math.max(1, Math.abs(yClose - yOpen));
    const top = Math.min(yOpen, yClose);
    ctx.fillStyle = up ? '#16a34a' : '#dc2626';
    ctx.fillRect(left, top, w, h);
  }
  function fmtDate(iso){
    // show as M/D
    const d = new Date(iso + 'T00:00:00');
    if(!isFinite(d)) return iso;
    return (d.getMonth()+1) + '/' + d.getDate();
  }
  function drawChart(canvas, series){
    const dpr = window.devicePixelRatio || 1;
    const H = 140, W = canvas.clientWidth || 260;
    canvas.width = Math.floor(W * dpr);
    canvas.height = Math.floor(H * dpr);
    const ctx = canvas.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0);

    const padL=34, padR=6, padT=8, padB=20;
    const plotW=W - padL - padR, plotH=H - padT - padB;
    let lo=Infinity, hi=-Infinity;
    series.forEach(s=>{ lo=Math.min(lo,s.l); hi=Math.max(hi,s.h); });
    if(!(isFinite(lo)&&isFinite(hi)) || hi<=lo){ lo=0; hi=1; }

    const n = series.length;
    const toX = i => padL + (i+0.5)*(plotW/n);
    const toY = v => padT + (hi - v) * (plotH/(hi-lo));

    // light grid
    ctx.strokeStyle='rgba(255,255,255,.07)'; ctx.lineWidth=1;
    [0.25,0.5,0.75].forEach(fr=>{
      const y=padT + fr*plotH; ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+plotW,y); ctx.stroke();
    });
    // axes (y left, x bottom) + labels
    const cs = getComputedStyle(document.documentElement);
    const muted = cs.getPropertyValue('--muted').trim() || '#8ea0b3';
    const border = cs.getPropertyValue('--border').trim() || '#223142';

    ctx.strokeStyle = border; ctx.lineWidth = 1;
    // y-axis
    ctx.beginPath(); ctx.moveTo(padL, padT); ctx.lineTo(padL, padT+plotH); ctx.stroke();
    // x-axis
    ctx.beginPath(); ctx.moveTo(padL, padT+plotH); ctx.lineTo(padL+plotW, padT+plotH); ctx.stroke();

    // y labels: hi / mid / lo
    ctx.fillStyle = muted; ctx.font = '10px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    ctx.textBaseline = 'middle';
    const midV = (hi + lo) / 2;
    [[hi, padT],[midV, padT+plotH/2],[lo, padT+plotH]].forEach(([v,y])=>{
      const txt = Number(v).toFixed(2);
      ctx.fillText(String(txt), 4, y);
    });

    // x labels: first / middle / last dates
    ctx.textBaseline = 'top';
    const nn = series.length;
    const first = series[0]?.d, last = series[nn-1]?.d, mid = series[Math.floor(nn/2)]?.d;
    if(first){ ctx.fillText(fmtDate(first), padL, padT+plotH+4); }
    if(mid){ const x = padL + plotW/2; const t = fmtDate(mid); ctx.fillText(t, x-ctx.measureText(t).width/2, padT+plotH+4); }
    if(last){ const t = fmtDate(last); const x = padL+plotW - ctx.measureText(t).width; ctx.fillText(t, x, padT+plotH+4); }

    // candles
    const barW = Math.max(3, Math.min(12, (plotW/n)*0.6));
    series.forEach((s,i)=>{
      drawCandle(ctx, toX(i), barW, toY(s.o), toY(s.c), toY(s.h), toY(s.l), s.c>=s.o);
    });
  }

  function card(item){
    const el = document.createElement('div'); el.className='gap-card';
    const head = document.createElement('div'); head.className='gap-head';
    const sym = document.createElement('div'); sym.className='gap-sym'; sym.textContent=item.symbol;
    head.appendChild(sym);

    let last = null, prev = null;
    if (item.series && item.series.length){
      last = item.series[item.series.length-1];
      if (item.series.length > 1) prev = item.series[item.series.length-2];
    }
    const priceVal = (last && isFinite(last.c)) ? last.c : null;
    const chg = (priceVal!=null && prev && isFinite(prev.c)) ? (priceVal - prev.c) : 0;

    const price = document.createElement('div');
    price.className = 'gap-price ' + (chg >= 0 ? 'up' : 'down');
    price.textContent = (priceVal!=null) ? ('$' + priceVal.toFixed(2)) : '—';

    // Right-side wrap so price + streak sit together
    const right = document.createElement('div');
    right.style.display = 'flex';
    right.style.alignItems = 'center';
    right.appendChild(price);

    // Only show streak if > 1
    const streakNum = Number(item.streak || 0);
    if (streakNum > 1) {
      const st = document.createElement('span');
      st.className = 'gap-streak';
      st.title = 'Consecutive days on the gap-up list';
      st.textContent = `${streakNum}d`;
      right.appendChild(st);
    }

    head.appendChild(right);

    const c = document.createElement('canvas'); c.className='gap-canvas';
    el.appendChild(head); el.appendChild(c);
    // draw after layout
    requestAnimationFrame(()=> drawChart(c, item.series));
    window.addEventListener('resize', ()=> drawChart(c, item.series));
    return el;
  }

  host.innerHTML='';
  DATA.forEach(it => host.appendChild(card(it)));
})();
</script>

<script>
// overview-icons-and-donuts-init (kept as-is)
(function(){
  const ICONS = {
    bots: '<span class="title-ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#9ecbff" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="10" rx="2"/><circle cx="8.5" cy="13" r="1.5"/><circle cx="15.5" cy="13" r="1.5"/><path d="M12 8V4"/><path d="M10 4h4"/></svg></span>',
    portfolios: '<span class="title-ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="#a7f3d0"><path d="M12 2c2.75 0 5 2.25 5 5s-2.25 5-5 5-5-2.25-5-5 2.25-5 5-5Zm-7 18c0-3.6 5.2-5.5 7-5.5s7 1.9 7 5.5v1H5v-1Z"/></svg></span>',
    market: '<span class="title-ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 15l4-4 3 3 4-6"/></svg></span>'
  };
  function prependIcon(titleRegex, svg){
    const el = Array.from(document.querySelectorAll('.section-title'))
      .find(x => titleRegex.test((x.textContent||'').trim()));
    if(!el) return;
    if(!el.querySelector('.title-ico')){
      el.insertAdjacentHTML('afterbegin', svg);
    }
  }
  prependIcon(/\bBots\b/i, ICONS.bots);
  prependIcon(/High Profile Portfolios/i, ICONS.portfolios);
  prependIcon(/Market (Studies|Analysis)/i, ICONS.market);

  // Also ensure mini donuts are present + click-through (this mirrors your earlier script)
  const SECTIONS = (function(){ try { return {{ sections_json | default('[]') | safe }}; } catch(e){ return []; } })();
  function pctText(n){ if(!isFinite(n)) return '—'; const p = n*100; return (p<0.1&&p>0)?'<0.1%':p.toFixed(2)+'%'; }
  function ensureMiniHost(){
    const heading = Array.from(document.querySelectorAll('.section-title'))
      .find(h => /High Profile Portfolios/i.test((h.textContent||'')));
    if(!heading) return null;
    const card = heading.closest('section') || heading.parentElement;
    if(!card) return null;
    card.classList.add('portfolios-card');
    let host = card.querySelector('#mini-portfolios');
    if(!host){
      host = document.createElement('div');
      host.className = 'mini-grid';
      host.id = 'mini-portfolios';
      heading.insertAdjacentElement('afterend', host);
    }
    return {card,host};
  }
  function drawMiniDonut(el, items){
    const w=120,h=120,cx=60,cy=60,r=44, ANGLE_OFFSET=Math.PI/2;
    const NS='http://www.w3.org/2000/svg';
    const svg=document.createElementNS(NS,'svg'); svg.setAttribute('viewBox','0 0 '+w+' '+h); svg.setAttribute('width', w); svg.setAttribute('height', h);
    let start=0;
    const pal=['#0021A5','#FA4616','#0077c0','#22884C','#D50A0A','#FCD006','#4B2A91','#6B21A8','#0EA5E9','#FF7900','#A855F7','#CA8A04','#34302B','#B1BABf'];
    (items||[]).forEach((x,i)=>{
      const frac=Math.max(0,x.weight||0);
      const end=start+frac*2*Math.PI;
      const large=(end-start)>Math.PI?1:0;
      const sA=start+ANGLE_OFFSET, eA=end+ANGLE_OFFSET;
      const x1=cx+r*Math.cos(sA), y1=cy+r*Math.sin(sA);
      const x2=cx+r*Math.cos(eA), y2=cy+r*Math.sin(eA);
      const p=document.createElementNS(NS,'path');
      p.setAttribute('d','M '+cx+' '+cy+' L '+x1+' '+y1+' A '+r+' '+r+' 0 '+large+' 1 '+x2+' '+y2+' Z');
      p.setAttribute('fill', pal[i%pal.length]);
      svg.appendChild(p);
      start=end;
    });
    const hole=document.createElementNS(NS,'circle');
    hole.setAttribute('cx', cx); hole.setAttribute('cy', cy);
    hole.setAttribute('r', String(Math.round(r*0.58)));
    try{
      const cs = getComputedStyle(document.documentElement);
      const fill = cs.getPropertyValue('--card').trim() || '#11161d';
      const stroke = cs.getPropertyValue('--border').trim() || '#223142';
      hole.setAttribute('fill', fill);
      hole.setAttribute('stroke', stroke);
      hole.setAttribute('stroke-width', '1');
    }catch(e){
      hole.setAttribute('fill', '#11161d');
      hole.setAttribute('stroke', '#223142');
      hole.setAttribute('stroke-width', '1');
    }
    svg.appendChild(hole);
    el.innerHTML=''; el.appendChild(svg);
  }
  function buildMini(sec){
    const pal=['#0021A5','#FA4616','#0077c0','#22884C','#D50A0A','#FCD006','#4B2A91','#6B21A8','#0EA5E9','#FF7900','#A855F7','#CA8A04','#34302B','#B1BABf'];
    const box=document.createElement('div'); box.className='mini-card';
    const pie=document.createElement('div'); pie.className='mini-pie';
    const legend=document.createElement('div'); legend.className='mini-legend';
    const title=document.createElement('div'); title.className='mini-title'; title.textContent=sec.name||'Portfolio';
    legend.appendChild(title);
    const items=(sec.holdings||[]);
    drawMiniDonut(pie, items);
    items.forEach((x,i)=>{
      const row=document.createElement('div'); row.className='row';
      const sw=document.createElement('span'); sw.className='sw'; sw.style.background=pal[i%pal.length];
      const label=document.createElement('span'); label.innerHTML=(x.ticker||'?')+' — '+pctText(x.weight);
      row.appendChild(sw); row.appendChild(label); legend.appendChild(row);
    });
    box.appendChild(pie); box.appendChild(legend);
    return box;
  }
  (function render(){
    const ctx = ensureMiniHost();
    if(!ctx) return;
    const {card,host} = ctx;
    host.innerHTML='';
    (SECTIONS||[]).forEach(sec => host.appendChild(buildMini(sec)));
    card.addEventListener('click', (e)=>{
      const a = e.target.closest && e.target.closest('a'); if(a) return;
      window.location.href = 'portfolios.html';
    });
  })();
})();
</script>

</body>
</html>
